# README: Тестирование приложения
Данный файл представляет собой пояснительную записку к проведённому тестированию 
разрабатываемого программного обеспечения (ПО). В основе методов тестирования используется 
библиотека pytest, а также другие дополнительные модули для обеспечения полноты тестов 
различных компонентов приложения.

## Описание структуры тестов

Тестирование организовано в пяти файлах:

* test_pg_basetest.py
* test_mainpy.py
* test_login.py
* test_qf.py
* test_grafik.py

1. Файл test_pg_basetest.py
Этот файл предназначен для тестирования работы с базой данных, в частности для проверки корректности взаимодействия с PostgreSQL. Включает тесты для следующих функций:

Проверка подключения к временно создаваемому шаблону базы данных, используемому системой.
Создание тестовых сущностей и связей таблиц — проверка правильности генерации таблиц и их связей.
Проверка записи данных в тестовые таблицы — обеспечивает правильность сохранения данных в базе.
Откат изменений — проверяет, что изменения в базе данных можно успешно откатить после тестов, 
гарантируя чистоту среды для последующих запусков.
Этот файл содержит параметры подключения к базе данных и функции для проверки её работоспособности, 
что помогает предотвратить возможные ошибки при взаимодействии с базой.

2. Файл test_mainpy.py
Этот файл содержит тесты для проверки функциональности основного приложения на основе FastAPI. 
Он покрывает различные аспекты пользовательского взаимодействия с приложением, включая 
аутентификацию, авторизацию и работу с продуктами. Тесты включают:

Настройка тестовой базы данных для проведения тестирования, создавая временную базу данных 
для изолированного выполнения тестов.
Получение сессии БД на время тестирования с использованием переопределённых зависимостей.
Инициализация тестового пользователя в базе данных для проверки процессов аутентификации и регистрации.

3. Файл test_login.py - закомментирован и преобразован в test_dbconn.py
Этот файл содержит тесты для проверки функциональности аутентификации и авторизации пользователей 
в приложении. Тестирование включает регистрацию пользователей, вход в систему и доступ к 
защищённым маршрутам с использованием токенов.

4. Файл test_qf.py
Этот файл содержит тесты прогноза, который используется в приложении. В процессе разработки.

5. Файл test_dbconn.py - бывший test_login
Этот файл содержит тесты роута, сессии БД и генерации токена.

6. Файл test_grafik.py
Этот файл содержит тесты построения графика и прогнозирования на основе данных формата JSON


## Основные тесты включают:

Тест главной страницы — проверяет доступность основной страницы приложения.

Тест регистрации нового пользователя — проверяет возможность создания нового пользователя.

Тесты аутентификации:
* Неудачный вход — проверка корректной обработки неверных учётных данных.
* Успешный вход — проверка процесса входа для существующего пользователя с корректными данными.

Тесты защищённых ресурсов:
* Доступ к защищённым маршрутам с валидным токеном.
* Попытка доступа без токена — проверка, что защищённые ресурсы недоступны без аутентификации.
* Попытка доступа с недействительным токеном — проверка корректной обработки невалидного токена.

Дополнительно, в тестах рассматриваются роли пользователей:
* Тесты для ролей админа и гостя — проверяются доступы к маршрутам в зависимости от роли
(админ или гость).

Также файл содержит тесты для работы с продуктами:
* Тест страницы количества продуктов — проверяет загрузку страницы отображения продуктов.
* Тест получения количества продукта — проверяет, что система возвращает корректное 
количество для запрашиваемого продукта.
* Тесты на ошибку при отсутствии продукта — проверяет, как система обрабатывает 
запросы на несуществующие продукты.

test_login:
* Тест регистрации пользователя - проверяет возможность регистрации нового пользователя в системе. 
Отправляется POST-запрос на регистрацию, проверяется успешность операции и соответствующее сообщение.
* Тест авторизации пользователя - проверяет процесс входа в систему для зарегистрированного пользователя. 
Отправляется POST-запрос на авторизацию, проверяется успешность входа и наличие токена в ответе.
* Тест доступа к защищённому ресурсу с токеном - проверяет доступность защищённого ресурса при наличии 
валидного токена. Сначала выполняется регистрация и авторизация пользователя, затем 
отправляется запрос на защищённый ресурс с токеном в заголовке.

test_qf:
* Тест загрузки датасета — проверяет корректную загрузку данных по продукту 
из внешнего CSV-файла. В ходе теста проверяется наличие требуемых столбцов, 
а также корректность преобразования данных.

* Тест прогнозируемости дат — тестирует, можно ли выполнить прогноз для 
указанных дат. В частности, проверяется, что начальная дата прогноза 
не выходит за пределы доступных данных, и если это так — прогноз невозможен.

* Тест выполнения прогноза — проверяет, что прогноз по продукту успешно 
формируется и возвращает данные как из исходного набора данных, так 
и спрогнозированные значения на будущее. В тесте используются mock-объекты для проверки без вызова реальных API.

* Тест генерации JSON-прогноза — тестирует метод, который возвращает 
прогноз в формате JSON. Убедившись в том, что прогноз выполнен корректно, 
тест проверяет, что возвращаются данные с правильными значениями дат и количеств.

* Тест обработки некорректных дат — проверяет, как система реагирует на 
запрос прогноза для дат, которые невозможно спрогнозировать. Ожидается, 
что в таких случаях выбрасывается корректное исключение с описанием проблемы.

test_dbconn.py
* Тест роута - проверка на существование роута
* Тест получения сессии из БД - проверка на создание таковой
* Тест генерации токена - проверка на правильность создания токена

test_grafik.py
* Тест вывода графика прогноза
* Тест создания графика